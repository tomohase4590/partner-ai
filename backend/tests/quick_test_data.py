"""
ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
"""

import sys
import os

# ãƒ‘ã‚¹ã‚’è¿½åŠ ï¼ˆbackend/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‚ç…§ï¼‰
BACKEND_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
sys.path.insert(0, BACKEND_DIR)

import sqlite3
from datetime import datetime
import json

DB_PATH = os.path.join(BACKEND_DIR, "partner_ai.db")
USER_ID = "demo_user"

# ãƒ†ã‚¹ãƒˆä¼šè©±ãƒ‡ãƒ¼ã‚¿
TEST_CONVERSATIONS = [
    # æŠ€è¡“ãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°
    ("Pythonã®åŸºç¤ã‚’æ•™ãˆã¦", "Pythonã¯åˆå¿ƒè€…ã«å„ªã—ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã™ã€‚å¤‰æ•°ã®å®£è¨€ãŒç°¡å˜ã§ã€èª­ã¿ã‚„ã™ã„æ§‹æ–‡ãŒç‰¹å¾´ã§ã™ã€‚", 5),
    ("æ©Ÿæ¢°å­¦ç¿’ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ", "æ©Ÿæ¢°å­¦ç¿’ã¯ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’ã™ã‚‹AIæŠ€è¡“ã§ã™ã€‚æ•™å¸«ã‚ã‚Šå­¦ç¿’ã€æ•™å¸«ãªã—å­¦ç¿’ã€å¼·åŒ–å­¦ç¿’ã®3ã¤ã«åˆ†é¡ã•ã‚Œã¾ã™ã€‚", 5),
    ("Djangoãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¤ã„ã¦", "Djangoã¯Pythonã®Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€MVTã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚é«˜é€Ÿé–‹ç™ºã«æœ€é©ã§ã™ã€‚", 4),
    ("SQLã¨NoSQLã®é•ã„ã¯ï¼Ÿ", "SQLã¯æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã€NoSQLã¯æŸ”è»Ÿãªã‚¹ã‚­ãƒ¼ãƒã‚’æŒã¡ã¾ã™ã€‚ç”¨é€”ã«ã‚ˆã£ã¦ä½¿ã„åˆ†ã‘ãŒé‡è¦ã§ã™ã€‚", 4),
    ("Gitã®åŸºæœ¬çš„ãªä½¿ã„æ–¹", "git init, add, commit, pushãŒåŸºæœ¬ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«å¿…é ˆã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚", 5),
    
    # AIãƒ»æ©Ÿæ¢°å­¦ç¿’
    ("ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä»•çµ„ã¿", "å…¥åŠ›å±¤ã€éš ã‚Œå±¤ã€å‡ºåŠ›å±¤ã‹ã‚‰æ§‹æˆã•ã‚Œã€é‡ã¿ã¨ãƒã‚¤ã‚¢ã‚¹ã‚’èª¿æ•´ã—ã¦å­¦ç¿’ã—ã¾ã™ã€‚", 5),
    ("ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯", "PyTorchã€TensorFlowã€KerasãŒä¸»æµã§ã™ã€‚ãã‚Œãã‚Œç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚", 4),
    ("éå­¦ç¿’ã‚’é˜²ãæ–¹æ³•", "ãƒ‰ãƒ­ãƒƒãƒ—ã‚¢ã‚¦ãƒˆã€æ­£å‰‡åŒ–ã€ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µãªã©ã®æ‰‹æ³•ãŒã‚ã‚Šã¾ã™ã€‚", 5),
    ("è‡ªç„¶è¨€èªå‡¦ç†ã«ã¤ã„ã¦", "NLPã¯ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†AIæŠ€è¡“ã§ã€TransformerãŒé©æ–°ã‚’ã‚‚ãŸã‚‰ã—ã¾ã—ãŸã€‚", 4),
    ("å¼·åŒ–å­¦ç¿’ã®å¿œç”¨ä¾‹", "ã‚²ãƒ¼ãƒ AIã€ãƒ­ãƒœãƒƒãƒˆåˆ¶å¾¡ã€è‡ªå‹•é‹è»¢ãªã©ã§æ´»ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚", 4),
    
    # è¿½åŠ ãƒ‡ãƒ¼ã‚¿ï¼ˆ15ä»¶ç›®ã¾ã§ï¼‰
    ("REST APIã®è¨­è¨ˆåŸå‰‡", "RESTã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯èƒ½ã€çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒåŸå‰‡ã§ã™ã€‚", 5),
    ("Dockerã‚³ãƒ³ãƒ†ãƒŠã¨ã¯", "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’éš”é›¢ã•ã‚ŒãŸç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹æŠ€è¡“ã§ã™ã€‚", 4),
    ("CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³", "ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•åŒ–ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚", 4),
    ("ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£", "ã‚¢ãƒ—ãƒªã‚’å°ã•ãªç‹¬ç«‹ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã«åˆ†å‰²ã™ã‚‹è¨­è¨ˆæ‰‹æ³•ã§ã™ã€‚", 5),
    ("ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°", "AWSã€Azureã€GCPãªã©ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ç†è§£ã‚’æ·±ã‚ã¾ã—ã‚‡ã†ã€‚", 4),
]

def add_test_data():
    """ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ """
    print("=" * 60)
    print("ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥é–‹å§‹")
    print("=" * 60)
    
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    
    # æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
    c.execute("SELECT COUNT(*) FROM conversations WHERE user_id = ?", (USER_ID,))
    existing_count = c.fetchone()[0]
    print(f"\næ—¢å­˜ã®ä¼šè©±æ•°: {existing_count}ä»¶")
    
    # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¿½åŠ 
    added = 0
    for user_msg, ai_msg, rating in TEST_CONVERSATIONS:
        timestamp = datetime.now().isoformat()
        metadata = json.dumps({
            "tags": ["ãƒ†ã‚¹ãƒˆ", "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°", "AI"],
            "reason": "ãƒ†ã‚¹ãƒˆç”¨ã®ä¼šè©±ãƒ‡ãƒ¼ã‚¿"
        }, ensure_ascii=False)
        
        c.execute("""
            INSERT INTO conversations 
            (user_id, timestamp, user_message, ai_response, model_used, rating, metadata)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, (USER_ID, timestamp, user_msg, ai_msg, "qwen2.5:7b", rating, metadata))
        
        added += 1
        print(f"  [{added:2d}] {user_msg[:40]}... (â­{rating})")
    
    conn.commit()
    
    # æœ€çµ‚ç¢ºèª
    c.execute("SELECT COUNT(*) FROM conversations WHERE user_id = ?", (USER_ID,))
    total_count = c.fetchone()[0]
    
    c.execute("""
        SELECT COUNT(*) FROM conversations 
        WHERE user_id = ? AND rating >= 3
    """, (USER_ID,))
    high_rated = c.fetchone()[0]
    
    conn.close()
    
    print("\n" + "=" * 60)
    print("âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº†")
    print("=" * 60)
    print(f"ç·ä¼šè©±æ•°: {total_count}ä»¶")
    print(f"é«˜è©•ä¾¡(â­3ä»¥ä¸Š): {high_rated}ä»¶")
    print(f"è¿½åŠ : {added}ä»¶")
    
    # ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æº–å‚™çŠ¶æ³
    if high_rated >= 10:
        print(f"\nğŸ‰ ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°å¯èƒ½ï¼({high_rated}/10ä»¶)")
    else:
        print(f"\nâš ï¸  ã‚ã¨{10 - high_rated}ä»¶ã®é«˜è©•ä¾¡ä¼šè©±ãŒå¿…è¦")
    
    return total_count, high_rated

if __name__ == "__main__":
    add_test_data()